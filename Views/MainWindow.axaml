<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:MarkdownViewer.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:MarkdownViewer.Views"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
        x:Class="MarkdownViewer.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{Binding WindowTitle}"
        Width="1200" Height="700"
        DragDrop.AllowDrop="True"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="32">

    <Design.DataContext>
        <vm:MainViewModel/>
    </Design.DataContext>

    <DockPanel>
        <!-- Compact Title Bar & Menu -->
        <Border DockPanel.Dock="Top" Background="#FCFCFC" Padding="0" Height="32">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- App Icon & Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="12,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="📝" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding WindowTitle}" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="#2C3E50"/>
                </StackPanel>

                <!-- Compact Menu Bar -->
                <Menu Grid.Column="1" Background="Transparent" VerticalAlignment="Center" Margin="20,0,0,0">
                    <MenuItem Header="File" Padding="8,4" FontSize="12">
                        <MenuItem Header="New" Command="{Binding NewFileCommand}" InputGesture="Ctrl+N"/>
                        <MenuItem Header="Open..." Command="{Binding OpenFileCommand}" InputGesture="Ctrl+O"/>
                        <MenuItem Header="Save" Command="{Binding SaveFileCommand}" InputGesture="Ctrl+S"/>
                        <MenuItem Header="Save As..." Command="{Binding SaveFileAsCommand}" InputGesture="Ctrl+Shift+S"/>
                        <Separator/>
                        <MenuItem Header="Export HTML..." Command="{Binding ExportHtmlCommand}"/>
                        <Separator/>
                        <MenuItem Header="Exit" Command="{Binding ExitCommand}" InputGesture="Alt+F4"/>
                    </MenuItem>
                    <MenuItem Header="Edit" Padding="8,4" FontSize="12">
                        <MenuItem Header="Bold" Command="{Binding ActiveDocument.EditorViewModel.InsertBoldCommand}" InputGesture="Ctrl+B"/>
                        <MenuItem Header="Italic" Command="{Binding ActiveDocument.EditorViewModel.InsertItalicCommand}" InputGesture="Ctrl+I"/>
                        <MenuItem Header="Link" Command="{Binding ActiveDocument.EditorViewModel.InsertLinkCommand}" InputGesture="Ctrl+K"/>
                        <MenuItem Header="Image" Command="{Binding ActiveDocument.EditorViewModel.InsertImageCommand}" InputGesture="Ctrl+Shift+I"/>
                        <MenuItem Header="Code Block" Command="{Binding ActiveDocument.EditorViewModel.InsertCodeBlockCommand}" InputGesture="Ctrl+Shift+C"/>
                        <MenuItem Header="Table" Command="{Binding ActiveDocument.EditorViewModel.InsertTableCommand}" InputGesture="Ctrl+T"/>
                    </MenuItem>
                    <MenuItem Header="View" Padding="8,4" FontSize="12">
                        <MenuItem Header="Toggle Read Mode" Command="{Binding ToggleReadModeCommand}" InputGesture="F6"/>
                    </MenuItem>
                </Menu>
            </Grid>
        </Border>

        <!-- Tabs Below Menu -->
        <Border DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#E0E0E0" BorderThickness="0,1,0,1" Padding="8,4">
            <TabControl x:Name="MainTabs" ItemsSource="{Binding Documents}" SelectedItem="{Binding ActiveDocument}" Name="TabControl" Background="Transparent" Padding="0">
                <TabControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:DocumentViewModel">
                        <Grid ColumnDefinitions="Auto,Auto" Margin="0" Background="Transparent">
                            <TextBlock Text="{Binding Title}"
                                       VerticalAlignment="Center"
                                       FontSize="11"
                                       Margin="6,0,4,0"/>
                            <Button Grid.Column="1"
                                    Command="{Binding DataContext.CloseDocumentCommand, ElementName=MainTabs}"
                                    CommandParameter="{Binding}"
                                    Width="14" Height="14"
                                    Padding="0"
                                    Margin="2,0,2,0"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    ToolTip.Tip="Close"
                                    CornerRadius="3">
                                <TextBlock Text="✕" FontSize="9" VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.6"/>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </TabControl.ItemTemplate>
            </TabControl>
        </Border>

        <!-- Compact Toolbar Below Tabs - Only in Edit Mode -->
        <Border DockPanel.Dock="Top"
                Name="ToolbarBorder"
                Padding="8,4"
                Background="#FAFBFC"
                BorderBrush="#E0E0E0"
                BorderThickness="0,0,0,1"
                IsVisible="{Binding !ActiveDocument.IsReadMode}">
            <StackPanel Orientation="Horizontal" Spacing="2" HorizontalAlignment="Left">
                <!-- Formatting Tools -->
                <Button Command="{Binding ActiveDocument.EditorViewModel.InsertBoldCommand}"
                        ToolTip.Tip="Bold (Ctrl+B)"
                        Width="26" Height="26"
                        Classes="toolbar-btn">
                    <TextBlock Text="B" FontWeight="Bold" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>
                <Button Command="{Binding ActiveDocument.EditorViewModel.InsertItalicCommand}"
                        ToolTip.Tip="Italic (Ctrl+I)"
                        Width="26" Height="26"
                        Classes="toolbar-btn">
                    <TextBlock Text="I" FontStyle="Italic" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>
                <Button Command="{Binding ActiveDocument.EditorViewModel.InsertLinkCommand}"
                        ToolTip.Tip="Insert Link (Ctrl+K)"
                        Width="26" Height="26"
                        Classes="toolbar-btn">
                    <TextBlock Text="🔗" FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>
                <Button Command="{Binding ActiveDocument.EditorViewModel.InsertCodeBlockCommand}"
                        ToolTip.Tip="Code Block (Ctrl+Shift+C)"
                        Width="26" Height="26"
                        Classes="toolbar-btn">
                    <TextBlock Text="&lt;/&gt;" FontSize="10" FontFamily="Consolas" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>

                <Separator Width="1" Height="18" Margin="4,0"/>

                <Button Command="{Binding ToggleReadModeCommand}"
                        ToolTip.Tip="Toggle Read Mode (F6)"
                        Width="26" Height="26"
                        Classes="toolbar-btn">
                    <TextBlock Text="👁" FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </Button>
            </StackPanel>
        </Border>

        <!-- Status Bar - Only visible in Edit Mode -->
        <Border DockPanel.Dock="Bottom"
                Background="#E5FFFFFF"
                Padding="10,5"
                Name="StatusBar"
                BorderBrush="#D0FFFFFF"
                BorderThickness="0,1,0,0"
                IsVisible="{Binding !ActiveDocument.IsReadMode}">
            <Border.Effect>
                <DropShadowEffect Color="#20000000" OffsetX="0" OffsetY="-2" BlurRadius="8"/>
            </Border.Effect>
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" Name="StatusText" FontSize="11" Opacity="0.8"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                    <TextBlock Text="{Binding ActiveDocument.EditorViewModel.State.WordCount, StringFormat='Words: {0}'}" VerticalAlignment="Center" FontSize="11" Opacity="0.8"/>
                    <TextBlock Text="{Binding ActiveDocument.EditorViewModel.State.CharCount, StringFormat='Characters: {0}'}" VerticalAlignment="Center" FontSize="11" Opacity="0.8"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content Area -->
        <ContentControl Content="{Binding ActiveDocument}" DockPanel.Dock="Top">
            <ContentControl.ContentTemplate>
                <DataTemplate x:DataType="vm:DocumentViewModel">
                    <views:EditorPreviewView DataContext="{Binding}"/>
                </DataTemplate>
            </ContentControl.ContentTemplate>
        </ContentControl>

        <!-- Drag & Drop overlay with Enhanced Glassmorphism -->
        <Border x:Name="DropOverlay"
                Background="#B0000000"
                IsVisible="False"
                ZIndex="1000">
            <Border BorderBrush="#80FFFFFF"
                    BorderThickness="2"
                    CornerRadius="16"
                    Margin="100"
                    Background="#C0FFFFFF">
                <Border.Effect>
                    <DropShadowEffect Color="#60000000" OffsetX="0" OffsetY="8" BlurRadius="32"/>
                </Border.Effect>
                <Border BorderBrush="#40FFFFFF"
                        BorderThickness="1"
                        CornerRadius="15"
                        Margin="2">
                    <StackPanel HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Spacing="20"
                               Margin="40">
                        <TextBlock Text="📄"
                                   HorizontalAlignment="Center"
                                   FontSize="72"
                                   Opacity="0.9"/>
                        <TextBlock Text="Drop Markdown files here"
                                   HorizontalAlignment="Center"
                                   Foreground="#2C3E50"
                                   FontSize="28"
                                   FontWeight="SemiBold"
                                   Opacity="0.95"/>
                        <TextBlock Text=".md, .markdown, .txt files and folders"
                                   HorizontalAlignment="Center"
                                   Foreground="#5A6C7D"
                                   FontSize="16"
                                   Opacity="0.85"/>
                    </StackPanel>
                </Border>
            </Border>
        </Border>
    </DockPanel>
</Window>
